# MCP Orchestrator 개발 프로젝트

## Metadata
- Status: In Progress
- Last Update: 2025-06-11
- Automatic Check Status: PASS

## 완료된 작업 요약

### 백엔드 개발 (TASK_001 ~ TASK_010) ✅ 완료
**핵심 성과**: MCP 서버들을 통합 관리하는 오케스트레이터 백엔드 완성
- **기본 구조**: 프로젝트 설정, 코어 컴포넌트(Registry, Adapter, Controller) 구현
- **MCP 통합**: 다중 MCP 서버 관리, stdio 통신, 프로세스 관리
- **API 서버**: FastAPI 기반 REST API, WebSocket 지원, 배치 처리
- **MCP Proxy 호환**: Cline과 완벽 호환되는 SSE 엔드포인트 구현
- **CLI**: 간소화된 명령어 인터페이스 (mcp-proxy 모드 중심)

### 웹 UI 개발 (TASK_011) ✅ 완료
**핵심 성과**: Next.js 14 + shadcn/ui 기반 완전한 웹 관리 인터페이스
- **기본 구조**: Next.js 14 App Router, shadcn/ui, Tailwind CSS v3, Zustand 상태관리
- **주요 페이지**: 대시보드, 서버 관리, 도구 실행, 로그 뷰어, Configuration
- **서버 상세 페이지**: 서버별 도구 표시, 실행 모달, 빠른 액션 버튼
- **Bearer Authorization**: API 토큰 기반 보안 인증 시스템
- **JSON 일괄 추가**: MCP 설정 JSON 파일 업로드 기능

### 조직 중심 아키텍처 전환 (TASK_011-ORG) ✅ 완료
**핵심 성과**: 개별 사용자에서 조직 중심 구조로 완전 전환
- **데이터베이스 스키마**: 조직별 MCP 서버 격리, mcp_servers/mcp_tools 테이블 생성
- **회원가입 시스템**: 자동 1인 조직 생성, 조직 멤버십 관리
- **인증 미들웨어**: JWT + API 키 통합 검증 시스템

### NextAuth.js v5 업그레이드 (TASK_011-AUTH) ✅ 완료
**핵심 성과**: Next.js 15 호환성 문제 해결 및 최신 인증 시스템 적용
- **패키지 업그레이드**: NextAuth.js v4 → v5, 새로운 handlers 구조
- **설정 마이그레이션**: auth.ts, API 라우트, 미들웨어 완전 재작성
- **기능 검증**: 로그인/로그아웃, 세션 관리, JWT 토큰 처리 정상 작동

### 프로젝트 중심 구조 전환 (TASK_023-PROJECT) ✅ 완료
**핵심 성과**: 독립적인 프로젝트 단위 협업 시스템 구현
- **데이터베이스 모델**: Project, ProjectMember 모델, 크로스팀 멤버십 지원
- **프로젝트별 SSE**: `/projects/{project_id}/servers/{server_name}/sse` 엔드포인트
- **프론트엔드 UI**: 6개 탭 프로젝트 상세 페이지, 이중 네비게이션 구조
- **멤버 데이터 표시**: "Unknown User" 문제 완전 해결

### JWT 토큰 기반 인증 전환 (TASK_022-JWT) ✅ 완료
**핵심 성과**: X-User-ID 헤더 방식을 JWT 토큰 기반으로 완전 전환
- **JWT 검증 개선**: NextAuth.js JWT 토큰과 완전 호환
- **헤더 방식 제거**: Authorization Bearer 토큰만 지원
- **팀 상세 페이지**: JWT 기반 API 호출 및 권한 검증

### 서버 상세 모달 구현 (TASK_025-SERVER-DETAIL) ✅ 완료
**핵심 성과**: 서버 카드 클릭 시 상세 정보 표시 모달 구현
- **탭 기반 UI**: 개요, 도구, 로그, 설정 탭
- **서버 제어**: 활성화/비활성화, 재시작, 편집/삭제 기능
- **API 연동**: 프로젝트별 서버 상세 정보 조회/수정/삭제

### 프로젝트 중심 UI/UX 고도화 (TASK_024-PROJECT-UI) ✅ 완료
**핵심 성과**: 프로젝트 중심 구조에 최적화된 사용자 인터페이스
- **권한 기반 UI**: Owner/Developer/Reporter 역할별 UI 제어
- **프로젝트 컨텍스트**: 전역 프로젝트 선택기, 자동 데이터 새로고침
- **멤버 관리**: GitLab 스타일 멤버 테이블, 역할 변경, 초대 시스템
- **리소스 필터링**: 프로젝트별 서버/도구 격리 표시
- **즐겨찾기 시스템**: 프로젝트 즐겨찾기 추가/제거, 상단 정렬
- **키보드 단축키**: Ctrl+P (프로젝트 선택), Ctrl+1~9 (빠른 전환)

## 현재 진행 중인 작업

### TASK_026-PROJECT-FOCUS: 프로젝트 중심 아키텍처 강화 🔥 (HIGH 우선순위)
**핵심 목표**: 전역 서버 관리를 관리자 전용으로 제한하고 모든 기능을 프로젝트 중심으로 통합

- [x] **프로젝트 서버 카드 클릭 라우팅 수정**
  - ✅ 프로젝트 서버 카드 클릭 시 `/projects/[projectId]/servers/[serverId]` 경로로 이동
  - ✅ 프로젝트 컨텍스트 유지하여 올바른 서버 데이터 로드

- [x] **서버 스토어 프로젝트 지원 확장**
  - ✅ `serverStore`에 프로젝트별 서버 조회 함수 추가 (`fetchProjectServers`, `getProjectServers`)
  - ✅ 프로젝트별 서버 캐시 시스템 구현 (`projectServers: Record<string, MCPServer[]>`)
  - ✅ 프로젝트 서버 페이지에서 서버 스토어 활용하도록 수정
  - ✅ 중복된 로컬 상태 관리 로직 제거

- [ ] **전역 서버 관리 권한 제한**
  - `/servers` 경로를 관리자 전용으로 제한
  - 일반 사용자는 프로젝트 내 서버만 접근 가능
  - 권한 없는 사용자 접근 시 프로젝트 페이지로 리디렉션

- [ ] **네비게이션 구조 정리**
  - 일반 사용자: Projects → Servers (프로젝트 내)
  - 관리자: Projects + Global Servers (전역 관리)
  - 메뉴 표시/숨김을 권한에 따라 동적 처리

## 향후 계획된 작업

### 🎯 **핵심 기능 우선 구현** (HIGH 우선순위)

- [ ] **프로젝트별 MCP 서버 등록 시스템** 🔥
  - [ ] 새 MCP 서버 추가 폼 (이름, 명령어, 인자, 환경 변수)
  - [ ] 서버 설정 편집 다이얼로그
  - [ ] 서버 삭제 및 활성화/비활성화 토글
  - [ ] 서버 상태 실시간 표시

- [ ] **GitHub 스타일 API 키 관리 시스템** 🔥
  - [ ] API 키 생성 후 전체 키 표시 다이얼로그
  - [ ] 클립보드 복사 기능 및 보안 경고 메시지
  - [ ] API 키 목록에서 키 이름만 표시 (보안)
  - [ ] API 키 삭제 기능

- [ ] **Cline 설정 자동 생성 및 다운로드** 🔥
  - [ ] 프로젝트별 Cline 설정 파일 생성
  - [ ] 설정 파일 다운로드 버튼
  - [ ] 클립보드 복사 기능
  - [ ] 설정 가이드 및 사용법 표시

- [ ] **실제 MCP 서버 연동 테스트** 🔥
  - [ ] 프로젝트에 실제 MCP 서버 추가 테스트
  - [ ] API 키로 SSE 엔드포인트 접근 테스트
  - [ ] Cline에서 생성된 설정으로 연결 테스트
  - [ ] 도구 실행 및 결과 확인

### 추가 고급 기능 (MEDIUM/LOW 우선순위)

- [ ] **프로젝트 템플릿 시스템**: 프로젝트 생성 시 템플릿 선택
- [ ] **하이브리드 설정 관리**: DB 저장 + JSON Import/Export
- [ ] **병렬화 모드**: LLM과 협력한 작업 자동 병렬 처리
- [ ] **엔터프라이즈 기능**: SSO 통합, 고급 모니터링, API 확장성

## Progress Status
- Current Progress: 🔧 **프로젝트 중심 아키텍처 강화** → 라우팅 및 권한 시스템 정리
- Next Task: 프로젝트 서버 카드 클릭 라우팅 수정
- Last Update: 2025-06-11
- Automatic Check Feedback: **✅ 프로젝트 중심 구조 안정화**
  - 현재 상태: 프로젝트 중심 UI/UX 고도화 완료 ✅
  - 해결 내용: 권한 기반 UI, 멤버 관리, 즐겨찾기, 키보드 단축키 모든 기능 구현
  - 영향: 사용자 경험 대폭 개선, 프로젝트 중심 워크플로우 완성
  - 다음 단계: 프로젝트 중심 아키텍처 강화로 전역 서버 관리 권한 제한

### 🎯 **즉시 진행 목표** (다음 4주간)
**Week 1**: 프로젝트 서버 라우팅 수정 및 권한 제한
**Week 2**: 프로젝트별 MCP 서버 등록 시스템
**Week 3**: API 키 관리 및 Cline 설정 자동 생성
**Week 4**: 실제 MCP 서버 연동 테스트

## 주요 기술 스택
- **백엔드**: Python, FastAPI, MCP SDK, PostgreSQL + SQLAlchemy
- **프론트엔드**: Next.js 14, TypeScript, shadcn/ui, Zustand
- **인증**: NextAuth.js v5, JWT 토큰
- **통신**: REST API, Server-Sent Events (SSE)
- **패키지 관리**: uv (백엔드), pnpm (프론트엔드)

## 핵심 인사이트
- **프로젝트 중심 아키텍처**: 팀 경계를 넘나드는 유연한 협업 구조가 핵심
- **JWT 토큰 인증**: NextAuth.js v5와 완전 호환되는 토큰 기반 인증 시스템
- **권한 기반 UI**: Owner/Developer/Reporter 3단계 역할 시스템으로 세분화된 접근 제어
- **사용자 경험**: 키보드 단축키, 즐겨찾기, 실시간 업데이트로 생산성 향상
- **MCP 호환성**: Cline과 100% 호환되는 SSE 엔드포인트로 기존 도구와 완벽 연동
